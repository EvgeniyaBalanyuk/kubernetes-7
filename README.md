# Домашнее задание к занятию «Компоненты Kubernetes»

### Цель задания

Рассчитать требования к кластеру под проект

------

### Инструменты и дополнительные материалы, которые пригодятся для выполнения задания:

- [Considerations for large clusters](https://kubernetes.io/docs/setup/best-practices/cluster-large/),
- [Architecting Kubernetes clusters — choosing a worker node size](https://learnk8s.io/kubernetes-node-size).

------

### Задание. Необходимо определить требуемые ресурсы
Известно, что проекту нужны база данных, система кеширования, а само приложение состоит из бекенда и фронтенда. Опишите, какие ресурсы нужны, если известно:

1. Необходимо упаковать приложение в чарт для деплоя в разные окружения. 
2. База данных должна быть отказоустойчивой. Потребляет 4 ГБ ОЗУ в работе, 1 ядро. 3 копии. 
3. Кеш должен быть отказоустойчивый. Потребляет 4 ГБ ОЗУ в работе, 1 ядро. 3 копии. 
4. Фронтенд обрабатывает внешние запросы быстро, отдавая статику. Потребляет не более 50 МБ ОЗУ на каждый экземпляр, 0.2 ядра. 5 копий. 
5. Бекенд потребляет 600 МБ ОЗУ и по 1 ядру на копию. 10 копий.

## Ответ:

1. Расчёт требуемых ресурсов
   
1.1. База данных
Требуется 3 копии базы данных для отказоустойчивости.
Каждая копия потребляет 4 ГБ ОЗУ и 1 ядро процессора.
Итого для базы данных:
ОЗУ: 4 ГБ * 3 = 12 ГБ
Ядра: 1 ядро * 3 = 3 ядра

1.2. Кеширование

Требуется 3 копии системы кеширования для отказоустойчивости.
Каждая копия кеша потребляет 4 ГБ ОЗУ и 1 ядро процессора.
Итого для кеша:
ОЗУ: 4 ГБ * 3 = 12 ГБ
Ядра: 1 ядро * 3 = 3 ядра

1.3. Фронтенд
Фронтенд обрабатывает статику, требуются 5 копий.
Каждая копия потребляет 50 МБ ОЗУ и 0.2 ядра.
Итого для фронтенда:
ОЗУ: 50 МБ * 5 = 250 МБ (0.25 ГБ)
Ядра: 0.2 ядра * 5 = 1 ядро

1.4. Бекенд
Бекенд требует 10 копий.
Каждая копия потребляет 600 МБ ОЗУ и 1 ядро.
Итого для бекенда:
ОЗУ: 600 МБ * 10 = 6 ГБ
Ядра: 1 ядро * 10 = 10 ядер

1. Итого ресурсы
ОЗУ:
База данных: 12 ГБ
Кеш: 12 ГБ
Фронтенд: 0.25 ГБ
Бекенд: 6 ГБ
Итого ОЗУ: 12 + 12 + 0.25 + 6 = 30.25 ГБ
Ядра:
База данных: 3 ядра
Кеш: 3 ядра
Фронтенд: 1 ядро
Бекенд: 10 ядер
Итого ядра: 3 + 3 + 1 + 10 = 17 ядер
2. Учет запаса
Для обеспечения отказоустойчивости и выхода из строя одной ноды, добавим запас в 30%.
ОЗУ с запасом: 30.25 ГБ * 1.3 = 39.325 ГБ
Ядра с запасом: 17 ядер * 1.3 = 22.1 ядра
3. Служебные ресурсы
Дополнительно, для разных типов нод, потребуется учесть служебные ресурсы для:
Ноды управления (например, для Kubernetes, если используется).
Дополнительные ресурсы на мониторинг, логирование, балансировку нагрузки.
Предположим, что для каждой ноды потребуется 1 ядро и 2 ГБ ОЗУ для служебных нужд. Дополнительно добавим 2 ноды для управления и мониторинга.
Служебные ресурсы: 2 ноды * 1 ядро * 2 ГБ ОЗУ = 2 ядра и 4 ГБ ОЗУ
Итак, учтём эти ресурсы в общей потребности:
ОЗУ с учетом служебных ресурсов: 39.325 ГБ + 4 ГБ = 43.325 ГБ
Ядра с учетом служебных ресурсов: 22.1 ядра + 2 ядра = 24.1 ядра
4. Количество нод
Теперь нужно определить количество нод, которые смогут справиться с такой нагрузкой.
Предположим, что на каждой ноде будет находиться несколько компонентов: база данных, кеш, фронтенд и бекенд. Определим ресурсы для одной ноды, которая будет обслуживать несколько компонентов.
Нода для базы данных и кеша:
База данных и кеш: 12 ГБ + 12 ГБ = 24 ГБ
Ядра для базы данных и кеша: 3 ядра + 3 ядра = 6 ядер
Это будет достаточно для одной ноды, обслуживающей базу данных и кеш.
Нода для фронтенда и бекенда:
Фронтенд и бекенд: 6 ГБ (бекенд) + 0.25 ГБ (фронтенд) = 6.25 ГБ
Ядра для фронтенда и бекенда: 10 ядер (бекенд) + 1 ядро (фронтенд) = 11 ядер
Для фронтенда и бекенда потребуется одна мощная нода.
Итак, минимальное количество нод:
1 нода для базы данных и кеша (24 ГБ ОЗУ, 6 ядер)
1 нода для фронтенда и бекенда (6.25 ГБ ОЗУ, 11 ядер)
Для учёта отказоустойчивости добавим по одной резервной ноде для каждого типа.
Итак, общее количество нод:
2 ноды для базы данных и кеша (каждая по 24 ГБ ОЗУ и 6 ядер)
2 ноды для фронтенда и бекенда (каждая по 6.25 ГБ ОЗУ и 11 ядер)
5. Итоговые параметры для нод
Каждая нода:
ОЗУ: 24 ГБ (для базы данных и кеша) или 6.25 ГБ (для фронтенда и бекенда)
Ядра: 6 ядер (для базы данных и кеша) или 11 ядер (для фронтенда и бекенда)
Количество нод:
2 ноды для базы данных и кеша
2 ноды для фронтенда и бекенда
Таким образом, для реализации проекта потребуется минимум 4 ноды.
Заключение
Для выполнения задачи нужно:
2 ноды для базы данных и кеша с 24 ГБ ОЗУ и 6 ядрами на каждую.
2 ноды для фронтенда и бекенда с 6.25 ГБ ОЗУ и 11 ядрами на каждую.
Важно учесть служебные ресурсы для управления и мониторинга, что потребует дополнительного выделения серверов в инфраструктуре.

----

### Правила приёма работы

1. Домашняя работа оформляется в своем Git-репозитории в файле README.md. Выполненное домашнее задание пришлите ссылкой на .md-файл в вашем репозитории.
2. Сначала сделайте расчёт всех необходимых ресурсов.
3. Затем прикиньте количество рабочих нод, которые справятся с такой нагрузкой.
4. Добавьте к полученным цифрам запас, который учитывает выход из строя как минимум одной ноды. 
5. Добавьте служебные ресурсы к нодам. Помните, что для разных типов нод требовния к ресурсам разные. 
6. В результате должно быть указано количество нод и их параметры.